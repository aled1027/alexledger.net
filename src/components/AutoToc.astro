---
// This is client-side table of contents that reads h2 and h3 elements on the page
// to populate itself. This version uses jquery
---

<div class="toc-target"></div>

<script
  src="https://code.jquery.com/jquery-3.7.1.slim.min.js"
  integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8="
  crossorigin="anonymous"></script>

<script is:inline>
  document.addEventListener("DOMContentLoaded", function () {
    var ToC =
      "<nav role='navigation' class='table-of-contents'>" +
      "<h2>Table of Contents</h2>" +
      "<ol>";

    var newLine,
      el,
      title,
      link,
      isFirstH2 = true;

    $("h2, h3").each(function () {
      el = $(this);

      const isH2 = el.prop("tagName") == "H2";
      const isH3 = el.prop("tagName") == "H3";
      console.log(isH3);

      title = el.text();
      link = "#" + el.attr("id");

      newLine = "<li><a href='" + link + "'>" + title + "</a>" + "</li>";

      // There are three options.
      // First, if it's not the first h2, then do this:
      // Second, if it's the first h2, then do this without the ol
      // Third, if it's an h3, don't do this
      if (isH2 && isFirstH2) {
        newLine = newLine + "<ol class='table-of-contents-inner'>";
        isFirstH2 = false;
      } else if (isH2) {
        newLine = "</ol>" + newLine + "<ol class='table-of-contents-inner'>";
      }

      // if it's an H2, open it up

      ToC += newLine;
    });

    ToC += "</ol>" + "</ol>" + "</nav>";
    console.log(ToC);

    $(".toc-target").prepend(ToC);
  });
</script>

<style is:global>
  /* NOTE THIS IS ARE GLOBAL */

  .table-of-contents {
    margin: 0 auto;
    width: fit-content;
    /* background: var(--surface-2); */
    background-color: rgba(var(--fun-1-rgb), 0.1);
    border-radius: var(--radius-2);
    padding: 0.5rem 2rem 1rem 2rem;

    @media (min-width: 600px) {
      margin: 1rem 2.5rem;
      float: right;
    }
  }

  .table-of-contents-inner li {
    list-style-type: lower-roman;
  }
</style>
